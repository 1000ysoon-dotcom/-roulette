<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ì‹ ì´Œ ê¾¼ ë‚šì‹œì¹´í˜ - ì¦‰ì‹œ ë£°ë ›</title>
  <meta name="color-scheme" content="light dark">
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
  <style>
    :root{--bg:#0b1020;--card:#121a2d;--accent:#3ecf8e;--accent2:#4ea1ff;--text:#e9f0ff;--muted:#a6b6d8;--gold:#ffd166}
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;
      background:#0b1020; color:var(--text);
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:16px;
    }
    .card{
      width:min(920px,100%); background:linear-gradient(180deg,rgba(255,255,255,0.06),rgba(0,0,0,0.2));
      border:1px solid rgba(255,255,255,0.08); border-radius:24px; padding:18px;
      box-shadow:0 20px 60px rgba(0,0,0,.35)
    }
    .badge{display:inline-block;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);
           padding:6px 10px;border-radius:999px;font-size:12px;color:var(--muted)}
    h1{margin:6px 0 10px;font-weight:900;letter-spacing:.3px}
    .wheelbox{position:relative;aspect-ratio:1/1;max-width:520px;width:100%;margin:0 auto}
    .pin{position:absolute;top:-8px;left:50%;transform:translateX(-50%);
         width:0;height:0;border-left:16px solid transparent;border-right:16px solid transparent;
         border-bottom:28px solid var(--gold);filter:drop-shadow(0 4px 6px rgba(0,0,0,.5))}
    canvas{width:100%;height:100%}
    .legend{margin-top:10px;color:var(--muted);font-size:12px;text-align:center}
    .result{margin-top:10px;font-size:1.2rem;font-weight:900;text-align:center}
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;
           background:rgba(0,0,0,.55);z-index:5;padding:16px}
    .modal.show{display:flex}
    .sheet{width:min(520px,100%);background:linear-gradient(180deg,#111827,#0b1222);
           color:var(--text);border:1px solid rgba(255,255,255,.12);border-radius:20px;
           padding:20px;text-align:center;box-shadow:0 10px 40px rgba(0,0,0,.5)}
    .sheet h2{margin:0 0 8px;font-size:1.4rem}
    .sheet .gift{font-size:1.6rem;font-weight:900;margin:8px 0 12px;color:var(--gold)}
    .hint{color:var(--muted);font-size:12px;text-align:center;margin-top:6px}
    .footer{margin-top:10px;text-align:center;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <div class="card">
    <div class="badge" id="badgeCampaign">QR ì´ë²¤íŠ¸</div>
    <h1>ì‹ ì´Œ ê¾¼ ë‚šì‹œì¹´í˜ <span style="color:var(--accent2)">ì¦‰ì‹œ ë£°ë ›</span> (1íšŒ í•œì •)</h1>
    <div class="wheelbox">
      <div class="pin"></div>
      <canvas id="wheel" width="800" height="800" aria-label="ë£°ë › ë°”í€´"></canvas>
    </div>
    <div class="result" id="result"></div>
    <div class="legend">ì´ í˜ì´ì§€ëŠ” ìë™ìœ¼ë¡œ í•œ ë²ˆë§Œ ìŠ¤í•€ë©ë‹ˆë‹¤. (ë‹¤ì‹œ ëŒë¦¬ê¸° ì—†ìŒ)</div>
    <div class="hint">URL ì˜ˆì‹œ: <code>?token=PALCHI15&campaign=í˜„ì¥ë£°ë ›</code></div>
    <div class="footer">Â© ì‹ ì´Œ ê¾¼ ë‚šì‹œì¹´í˜</div>
  </div>

  <div class="modal" id="modal">
    <div class="sheet">
      <div class="badge" id="badge2">QR ì´ë²¤íŠ¸</div>
      <h2>ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰</h2>
      <div class="gift" id="giftName">ìƒí’ˆëª…</div>
      <div class="hint" id="giftDesc"></div>
    </div>
  </div>

<script>
const PRIZES = [
  { name: "ğŸ¥¤ ì‹œì›í•œ ê¾¼-ë“œë§í¬",        note: "ğŸ‘‰ ìˆ˜ë ¹ì€ ì¹´ìš´í„°ì—ì„œ!", weight: 18, color: "#4ea1ff" },
  { name: "ğŸ’ ê¾¼í¬ì¸íŠ¸ +2000",          note: "ğŸ‘‰ ìˆ˜ë ¹ì€ ì¹´ìš´í„°ì—ì„œ!", weight: 15, color: "#34d399" },
  { name: "ğŸŸ ê¾¼-í¬í…Œì´í† ì¹©",           note: "ğŸ‘‰ ìˆ˜ë ¹ì€ ì¹´ìš´í„°ì—ì„œ!", weight: 12, color: "#f472b6" },
  { name: "ğŸ’ ê¾¼í¬ì¸íŠ¸ +1000",          note: "ğŸ‘‰ ìˆ˜ë ¹ì€ ì¹´ìš´í„°ì—ì„œ!", weight: 10, color: "#22d3ee" },
  { name: "ğŸ ì¶”ì–µì˜ ê¾¼-ë½‘ê¸°",          note: "ğŸ‘‰ ìˆ˜ë ¹ì€ ì¹´ìš´í„°ì—ì„œ!", weight: 10, color: "#f59e0b" },

  { name: "ğŸ’¸ ê¾¼í• ì¸ê¶Œ 1ì²œ",            note: "ğŸ‘‰ ìˆ˜ë ¹ì€ ì¹´ìš´í„°ì—ì„œ!", weight: 8,  color: "#a78bfa" },
  { name: "âœŠ ê¾¼-ìŠ¤íƒ­ ê°€ìœ„ë°”ìœ„ë³´",      note: "ğŸ‘‰ ìˆ˜ë ¹ì€ ì¹´ìš´í„°ì—ì„œ!", weight: 7,  color: "#60a5fa" },
  { name: "ğŸ’¸ ê¾¼í• ì¸ê¶Œ 2ì²œ",            note: "ğŸ‘‰ ìˆ˜ë ¹ì€ ì¹´ìš´í„°ì—ì„œ!", weight: 6,  color: "#10b981" },

  { name: "â° ì˜¤ëŠ˜ë§Œ ê¾¼í• ì¸ 1ì²œ",       note: "ğŸ‘‰ ìˆ˜ë ¹ì€ ì¹´ìš´í„°ì—ì„œ!", weight: 5,  color: "#8b5cf6" },
  { name: "ğŸ’¸ ê¾¼í• ì¸ê¶Œ 3ì²œ",            note: "ğŸ‘‰ ìˆ˜ë ¹ì€ ì¹´ìš´í„°ì—ì„œ!", weight: 4,  color: "#f97316" },
  { name: "ğŸ¡ ê¾¼-ë³´ë„ˆìŠ¤ ì°¬ìŠ¤",          note: "ğŸ‘‰ ìˆ˜ë ¹ì€ ì¹´ìš´í„°ì—ì„œ!", weight: 3,  color: "#eab308" },
  { name: "ğŸ’¸ ê¾¼í• ì¸ê¶Œ 5ì²œ",            note: "ğŸ‘‰ ìˆ˜ë ¹ì€ ì¹´ìš´í„°ì—ì„œ!", weight: 2,  color: "#ef4444" }
];

const ONE_SPIN_PER_TOKEN = true;
const qs = new URLSearchParams(location.search);
const token = qs.get("token") || "";
const campaign = qs.get("campaign") || "QR ì´ë²¤íŠ¸";
document.getElementById("badgeCampaign").textContent = campaign;
document.getElementById("badge2").textContent = campaign;

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");
const center = canvas.width/2;
const radius = canvas.width/2 - 12;

function drawWheel(angle=0){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const total = PRIZES.reduce((s,p)=>s+p.weight,0);
  let start = angle;
  for(const p of PRIZES){
    const sweep = (p.weight/total)*Math.PI*2;
    ctx.beginPath(); ctx.moveTo(center,center);
    ctx.arc(center,center,radius,start,start+sweep);
    ctx.closePath(); ctx.fillStyle = p.color; ctx.fill();
    ctx.strokeStyle="rgba(0,0,0,.25)"; ctx.lineWidth=2; ctx.stroke();
    ctx.save(); ctx.translate(center,center);
    const mid=start+sweep/2; ctx.rotate(mid);
    ctx.textAlign="right"; ctx.fillStyle="#0b1020";
    ctx.font="bold 22px system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif";
    ctx.fillText(p.name, radius-18, 8);
    ctx.restore();
    start+=sweep;
  }
  ctx.beginPath(); ctx.arc(center,center,56,0,Math.PI*2);
  ctx.fillStyle="#111827"; ctx.fill();
  ctx.strokeStyle="rgba(255,255,255,.25)"; ctx.lineWidth=3; ctx.stroke();
  ctx.fillStyle="#e9f0ff"; ctx.font="900 18px system-ui,'Noto Sans KR',sans-serif";
  ctx.textAlign="center"; ctx.fillText("SPIN",center,center+6);
}
drawWheel(0);

let spun=false, currentAngle=0;
function weightedRandomIndex(){
  const total=PRIZES.reduce((s,p)=>s+p.weight,0);
  let r=Math.random()*total;
  for(let i=0;i<PRIZES.length;i++){ r-=PRIZES[i].weight; if(r<=0) return i; }
  return PRIZES.length-1;
}
function indexAtAngle(angle){
  const total=PRIZES.reduce((s,p)=>s+p.weight,0);
  let a=(angle%(Math.PI*2)+Math.PI*2)%(Math.PI*2);
  a=(a+Math.PI/2)%(Math.PI*2);
  let acc=0;
  for(let i=0;i<PRIZES.length;i++){
    const sweep=(PRIZES[i].weight/total)*Math.PI*2;
    acc+=sweep; if(a<=acc) return i;
  }
  return PRIZES.length-1;
}
function spinOnce(){
  if(spun) return;
  const key=`kkun_spin_${campaign}_${token||"anon"}`;
  if(ONE_SPIN_PER_TOKEN && token && localStorage.getItem(key)){
    showModal({name:"ì´ë¯¸ ì°¸ì—¬ë¨", note:"ê°™ì€ QRì€ 1íšŒë§Œ ì°¸ì—¬ ê°€ëŠ¥í•©ë‹ˆë‹¤."});
    return;
  }
  spun=true;
  const targetIndex=weightedRandomIndex();
  const total=PRIZES.reduce((s,p)=>s+p.weight,0);
  let start=0; for(let i=0;i<targetIndex;i++){ start+=(PRIZES[i].weight/total)*Math.PI*2; }
  const sweep=(PRIZES[targetIndex].weight/total)*Math.PI*2;
  const targetMid=start+sweep/2;
  let finalAngle=(Math.PI*2*6)+(targetMid-Math.PI/2);
  finalAngle=Math.max(finalAngle,Math.PI*2*5.5);
  const duration=5200, startTime=performance.now(), startAngle=currentAngle;
  (function anim(now){
    const t=Math.min(1,(now-startTime)/duration);
    const e=1-Math.pow(1-t,3);
    const angle=startAngle+(finalAngle-startAngle)*e;
    currentAngle=angle; drawWheel(angle);
    if(t<1){ requestAnimationFrame(anim); }
    else{
      const idx=indexAtAngle(currentAngle);
      const prize=PRIZES[idx];
      if(ONE_SPIN_PER_TOKEN && token){ localStorage.setItem(key,"1"); }
      document.getElementById("result").textContent=`ë‹¹ì²¨: ${prize.name}`;
      showModal(prize);
    }
  })(startTime);
}
function showModal(prize){
  const m=document.getElementById("modal");
  document.getElementById("giftName").textContent=prize.name||"í™•ì¸ í•„ìš”";
  document.getElementById("giftDesc").textContent=prize.note||"";
  m.classList.add("show");
}
window.addEventListener("load", ()=>{ setTimeout(spinOnce, 800); }, {once:true});
</script>
</body>
</html>
